# tile-gl

2D context emulator in WebGL for vector tiles

![tests](https://github.com/GlobeletJS/tile-gl/actions/workflows/node.js.yml/badge.svg)

## Installation
tile-gl is provided as an ESM import
```javascript
import * as tileGL from 'tile-gl';
```

tileGL exposes two methods:
- initGLpaint: Initialize a 2D context emulator
- initSerializer: Initialize a geometry serializer, to parse GeoJSON
  features into buffers that can be rendered with the context emulator

## initGLpaint

### Syntax
A new context emulator can be initalized as follows:
```javascript
const context = tileGL.initGLpaint(parameters);
```

where the supplied parameters object has the following properties:
- `.context` (REQUIRED): A WebGL context wrapper, as created by the
  [yawgl][] method `initContext`
- `.framebuffer`: A framebuffer object, as created by `context.initFramebuffer`,
  on which draw calls will be executed. If null, draw calls will render
  directly to `context.gl.canvas`
- `.projScale`: A Boolean flag indicating whether to scale style dimensions
  by the ratio of the projection scale at the given feature, vs the supplied
  scalar (e.g., the projection scale at the camera position)
 
[yawgl]: https://github.com/GlobeletJS/yawgl

### API
The returned context object exposes the following methods:
- `.prep()`: Calls `context.bindFramebufferAndSetViewport` and `context.clear`,
  as prep for a draw call
- `.loadBuffers(buffers)`: Loads the supplied buffers
- `.loadAtlas(atlas)`: Loads a supplied atlas image object, as generated by
  [tile-labeler][]
- `.initPainter(style)`: Initializes a painter program for the given style
  layer. Note: the style layer must have been parsed by [tile-stencil][]

[tile-labeler]: https://github.com/GlobeletJS/tile-labeler
[tile-stencil]: https://github.com/GlobeletJS/tile-stencil

## initSerializer
Initializes a geometry serializer, to parse GeoJSON features into buffers
that can be rendered with the context emulator.

### Syntax
```javascript
const serializer = tileGL.initSerializer(style);
```

where the argument is a layer from a [MapLibre style document][MapLibre], 
as parsed by the getStyleFuncs method from [tile-stencil][].

[MapLibre]: https://maplibre.org/maplibre-gl-js-docs/style-spec/layers/

### API
The functionality of the returned serializer depends on the type of the
supplied style
- `circle`: Inputs Point or MultiPoint geometries, and creates the buffers
  needed to render circle styles
- `line`: Inputs LineString, MultiLineString, Polygon, or MultiPolygon
  geometries, and creates the buffers needed to render line styles
- `fill`: Inputs Polygon or MultiPolygon geometries, and creates the buffers
  needed to render fill styles
- `symbol`: Inputs Point features, and creates the buffers needed to render
  text labels, as generated by [tile-labeler][]

## TODO
- Finish this README
- Canvas2D strokeText method or similar, for text-halo
- Gapped lines for line-gap-width in MapLibre styles
